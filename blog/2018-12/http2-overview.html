<!doctype html>
<html lang="ja">
<head>
  <title>今更ながら HTTP/2 について調べてまとめてみた | Portfolio by hyiromori</title>
<meta content="今更ながら HTTP/2 について調べてまとめてみた | Portfolio by hyiromori" name="title">
<meta content="Web系フルスタックエンジニア hyiromori のポートフォリオサイトです。" name="description">
<meta content="HTTP/2,HTTP2,HTTP/1.1,HTTP" name="keywords">
<meta name="theme-color" content="#ff7701"/>
<meta property="og:title" content="今更ながら HTTP/2 について調べてまとめてみた | Portfolio by hyiromori" />
<meta property="og:description" content="Web系フルスタックエンジニア hyiromori のポートフォリオサイトです。" />
<meta property="og:image" content="/assets/images/logo.jpg" />
<meta property="og:url" content="https://portfolio.hyiromori.com/" />
<meta property="og:site_name" content="今更ながら HTTP/2 について調べてまとめてみた | Portfolio by hyiromori" />
<meta property="og:locale" content="ja-JP" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@hyiromori" />
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta charset="UTF-8">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link href="https://fonts.googleapis.com/css?family=Ubuntu|Source+Code+Pro|M+PLUS+1p" rel="stylesheet">
<link rel="stylesheet" href="/assets/styles/index.css" />
<link rel="stylesheet" href="/assets/styles/monokai-sublime.css">
<script src="/assets/scripts/highlight.pack.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124358962-1"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'UA-124358962-1');
</script>
  <link rel="stylesheet" href="/assets/styles/monokai-sublime.css">
<script src="/assets/scripts/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
</script>
  <meta property="og:type" content="article" />
</head>
<body>
  <div id="header">
    <div id="header-container">
      <a href="/" id="header-logo">
  <img id="logo-image" alt="Logo image" src="/assets/images/logo.jpg" decoding="async" />
  <div id="logo-text">
    <div id="logo-text-upper">hyiromori's</div>
    <div id="logo-text-lower">Portfolio</div>
  </div>
</a>
<nav id="header-navigation">
  <a href="/blog/">BLOG</a>
  <a href="/laboratory/">LABO</a>
</nav>

    </div>
  </div>
  <div id="content-wrapper">
    <div id="main-content">
      <h1>今更ながら HTTP/2 について調べてまとめてみた</h1>
      <!--
title: 今更ながら HTTP/2 について調べてまとめてみた
keywords: HTTP/2,HTTP2,HTTP/1.1,HTTP
-->

<h2 id="この記事の目的">この記事の目的</h2>
<p>今更ながら <strong>HTTP/2</strong> がどのようなものかを調べたくなったので、その結果をまとめた記事になります。<br>あくまで概要をまとめたもので、今はたくさんの良記事があるので、詳細が知りたい場合は最後の参考文献のリンク先を見ると参考になると思います。  </p>
<h2 id="HTTP/2 の特徴">HTTP/2 の特徴</h2>
<ul>
<li>ストリームという概念を導入したことで <strong>HTTP/1.1</strong> に比べて効率的に通信できます</li>
<li>ヘッダー圧縮を行うことで <strong>HTTP/1.1</strong> より通信量を減らすことができます</li>
<li>サーバープッシュによりリクエストされる前にサーバーからリソースを送信することで <strong>HTTP/1.1</strong> よりラウンドトリップ回数を減らすことができます</li>
<li><strong>HTTP/1.1</strong> と互換性があります</li>
<li>事実上 <code>TLS</code> による暗号化が必須になります</li>
<li>モダンブラウザは対応済です (最新の対応状況は <a href="https://caniuse.com/#search=http2">Can I Use</a> で確認してください)</li>
</ul>
<h2 id="ストリームとは？">ストリームとは？</h2>
<h3 id="HTTP/1.1 の欠点">HTTP/1.1 の欠点</h3>
<p><strong>HTTP/1.1</strong> では、１回目のリクエスト→１回目のレスポンス→２回目のリクエスト→・・・というように、一度リクエストをするとそのレスポンスを受け取ってから次のリクエストを行う必要があります。<br>大量の画像やファイルで構成されているページを表示する際には、この制約が大きなネックになります。そのため、モダンブラウザでは複数のコネクションを同時に使用することで高速化を図っているそうです。<br>また、<strong>HTTP/1.1</strong> では HTTP パイプラインという高速化手法もありますが、問題があることから、ほとんどのブラウザでは既定で無効になっています。  </p>
<h3 id="ストリームを導入することでどう変わるか？">ストリームを導入することでどう変わるか？</h3>
<p>ストリームとは、１つのコネクションの中に独立した複数の仮想的なコネクションのようなものがあり、リクエストとレスポンスを並列で行えるようになるため、１つのコネクションで効率的に通信が行えるようになります。</p>
<h2 id="ヘッダー圧縮とは？">ヘッダー圧縮とは？</h2>
<p><strong>HTTP/1.1</strong> は数百バイト〜数KBあるヘッダーを非圧縮かつ全てのヘッダーを毎回送受信する必要があります。<br><strong>HTTP/2</strong> では <strong>HPACK</strong> という圧縮方式を使用し、データ自体を圧縮するとともに、ヘッダーのキャッシュを行うことで差分のみを送受信することが可能になり、ヘッダーを効率よくやり取りできます。  </p>
<h2 id="サーバープッシュとは？">サーバープッシュとは？</h2>
<p><strong>HTTP/1.1</strong> では、通常最初に HTML ファイルを受け取ってから、再度描画に必要なリソースをリクエストする、という形になっています。<br><strong>HTTP/2</strong> では、リクエストに対し（クライアントからのリクエスト無しに）予めサーバーから必要と思われるリソースを送信することが可能になっています。<br>これにより、ラウンドトリップ回数を減らし、リソースの読み込みまでの時間を短縮することができます。</p>
<h2 id="HTTP/1.1 との互換性">HTTP/1.1 との互換性</h2>
<p><strong>HTTP/2</strong> 通信を開始する際は、最初に従来どおりの HTTP リクエストの中に、以下のヘッダー情報を加えて送信し、サーバーから <code>101 Switching Protocols</code> のレスポンスを受け取ってから <strong>HTTP/2</strong> の通信を開始することで、互換性を保っています。</p>
<ul>
<li><code>Connection: Upgrade, HTTP2-Settings</code></li>
<li><code>Upgrade: h2c</code></li>
</ul>
<h2 id="HTTP/2 を使うメリット">HTTP/2 を使うメリット</h2>
<p><strong>HTTP/2</strong> はここまでの説明の通り、様々な手法で効率よく通信を行えるようになるため、 <strong>HTTP/1.1</strong> よりページの読み込み時間が短縮されることが、最大のメリットだと思います。<br>また <strong>HTTP/1.1</strong> との互換性があるため、<strong>HTTP/2</strong> 非対応のブラウザであってもアクセス可能であるため、導入が容易であることもメリットであると思います。</p>
<h2 id="HTTP/2 を使うデメリット">HTTP/2 を使うデメリット</h2>
<p>全てのサイトで高速化されるわけではないことだと思います。例えば、もともと必要なソースが少なく、リクエスト数が少ない場合はあまり恩恵が受けられないと思います。
ただ、遅くなるわけではないので、デメリットという程でもないかと思います。<br>あとは <strong>HTTP/2</strong> に対応する作業コストといったところかと思いますので、実質デメリットはないかな、と思いました。  </p>
<h2 id="調べてみた感想">調べてみた感想</h2>
<p>HTTP というプロトコルはステートレスでシンプルなプロトコルが最大の特徴だと個人的には思っているのですが、HTTP/2 は結構複雑だな、という印象です。ヘッダーの圧縮とか、ステートレスな点もありますし。<br>ただそれも、HTTP が世界で圧倒的に普及した結果、僅かな高速化でも大きな影響があるため、あらゆる手法を取り入れていこうとした結果なのだろうな、とも思います。<br>デメリットもほぼないと言っても良さそうなので、利用できる時は積極的に使っていくべき技術だと感じました。  </p>
<h2 id="参考文献">参考文献</h2>
<ul>
<li><a href="https://developers.google.com/web/fundamentals/performance/http2/?hl=ja">HTTP/2 の概要  |  Web  |  Google Developers</a></li>
<li><a href="https://knowledge.sakura.ad.jp/7734/">普及が進む「HTTP/2」の仕組みとメリットとは | さくらのナレッジ</a></li>
<li><a href="https://blog.redbox.ne.jp/http2-cdn.html">HTTP/2の特徴 HTTP/1.1との違いについて | REDBOX Labo</a></li>
<li><a href="https://techblog.yahoo.co.jp/infrastructure/http2/introduction_to_http2/">HTTP/2 入門 - Yahoo! JAPAN Tech Blog</a></li>
<li><a href="https://labs.gree.jp/blog/2014/12/11987/">初めてのHTTP/2サーバプッシュ | GREE Engineers&#39; Blog</a></li>
<li><a href="https://ja.wikipedia.org/wiki/HTTP%E3%83%91%E3%82%A4%E3%83%97%E3%83%A9%E3%82%A4%E3%83%B3">HTTPパイプライン - Wikipedia</a></li>
</ul>

    </div>
    <div id="left-content"></div>
  </div>
  <div id="footer">
    <div id="footer-container">
      <nav id="footer-links">
  <a class="tooltip" data-tooltip="Mail" href="mailto:hyiromori@gmail.com">
    <img src="/assets/images/mail.png" alt="Mail Logo" decoding="async" />
  </a>
  <a class="tooltip" data-tooltip="Twitter" href="https://twitter.com/hyiromori">
    <img src="/assets/images/twitter.png" alt="Twitter Logo" decoding="async" />
  </a>
  <a class="tooltip" data-tooltip="GitHub" href="https://github.com/hyiromori">
    <img src="/assets/images/github.png" alt="GitHub Logo" decoding="async" />
  </a>
</nav>
<div id="footer-copyright">&copy 2018 hyiromori</div>
    </div>
  </div>
  <script type="text/javascript">
  function scrollToElement(id) {
    var position = document.getElementById(id).offsetTop - 16;
    window.scroll(0, position);
  }

  var leftContent = document.getElementById('left-content');
  if (leftContent != null) {
    var headers = [];
    document.querySelectorAll('h2').forEach(function(header) {
      headers.push(
        '<div>' +
        '<button onclick="scrollToElement(\'' + header.id + '\')">' +
        header.textContent +
        '</button>' +
        '</div>',
      );
    });
    leftContent.innerHTML = headers.join('');
  }
</script>
</body>
</html>
