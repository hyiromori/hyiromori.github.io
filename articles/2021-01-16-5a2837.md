---
title: "OpenID Connect についてと OAuth2.0 との違いを調べてみた"
emoji: "🔐"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["OIDC", "OpenIDConnect"]
published: false
---

# はじめに

最近、個人的に認証認可周りを学習していて、今回は OpenID Connect について学習したのでその内容をまとめた記事です。

世の中には既に OpenID Connect に関する優れた書籍やブログ記事が沢山ありますが、自分が学習する過程で色々なものを読むことでより理解が深まったと思うので、自分も学習したものをアウトプットすることで同じように学習している人の理解の助けになればと思い書きました。

この記事は [OAuth2.0の流れをまとめてみる](https://zenn.dev/hyiromori/articles/2020-12-28-oauth2) の続きという位置づけになっています。
OAuth2.0が分からないという方はこちらを先に読むことをおすすめします。

まだ私も学習中なので、もし間違ったところなどあればコメント頂けるとありがたいです。

# OpenID Connect とはなにか？

OAuth2.0をベースにして（認可だけでなく）認証も行えるようにした拡張仕様です。

なぜOAuth2.0が認証に使えないかというと、以下のように認証に使ってしまうとリスクが非常に高いからです。

https://www.sakimura.org/2012/02/1487/

ざっくりかいつまんで言うと、以下のようになります。

- OAuth2.0 を認証に使うということは、有効なアクセストークンをもって認証できたとみなす
- しかしアクセストークンには「いつ」「どこで」「なんのために」作られてものかが分からない
- 例えば悪意があるサイトなどが、ユーザーから取得したアクセストークンを別サイトのログインに使ってなりすますなどの危険性がある

こういった事情から、OAuth2.0で発行されたアクセストークンを認証に使ってはいけません。

:::message
ちなみに認証に使えないことはOAuth2.0の問題ではありません。
OAuth2.0はあくまで「認可」を対象にした仕様なので、対象外である「認証」に使って問題が発生することは当然です。
:::

# OAuth2.0 との一番大きな差分

用語が違ったりするなど細かい点はありますが、一番大きな違いは「IDトークン」が発行されることです。
IDトークンはアクセストークンにはない「いつ」「どこで」「なんのために」発行されたトークンなのかの情報を含んでおり、かつ署名されているため改ざんができない（改ざんを検知できる）ようになっています。

# IDトークンとはなにか？

IDトークンは JWT (JSON Web Token) という形式の文字列になっています。

```bash
# TODO: 具体例
```

# OAuth2.0でのフローの差分

この記事内ではOAuth2.0で定義されているフローの1つ、認可コードによる付与（Authorization Code Grant）をベースに差分を説明します。

# 参考資料

- [一番分かりやすい OpenID Connect の説明 - Qiita](https://qiita.com/TakahikoKawasaki/items/498ca08bbfcc341691fe)
- [OpenID Connect 全フロー解説 - Qiita](https://qiita.com/TakahikoKawasaki/items/4ee9b55db9f7ef352b47)

