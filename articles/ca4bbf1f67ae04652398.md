---
title: "ffmpeg.wasm を使ってGIF動画を作れるWebアプリを作って遊んでみた"
emoji: "📹"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["FFmpeg", "WebAssembly", "WASM"]
published: false
---

## はじめに

[フロントエンドの勉強会（コロナになってからはランチではなくおやつタイムにやっています）](https://www.wantedly.com/companies/connehito/post_articles/211397) で、

- [ffmpegwasm/ffmpeg.wasm: FFmpeg for browser and node, powered by WebAssembly](https://github.com/ffmpegwasm/ffmpeg.wasm)
- [ブラウザ上で動画生成や変換ができるWebAssembly版FFmpeg「ffmpeg.wasm」レビュー - GIGAZINE](https://gigazine.net/news/20201109-ffmpeg-wasm/)

@[tweet](https://twitter.com/hyiromori/status/1328251958788976641)

# 作ったWebアプリ

https://video-to-gif.vercel.app/

[hyiromori/video-to-gif: GitHub](https://github.com/hyiromori/video-to-gif)

Google Chrome だけ動作確認をしています。他のブラウザはおそらく使えません。
また大きな動画ファイルを変換した場合はエラーになります。
（これらの理由は「ハマりどころ」の章をご覧ください）

遊びレベルで作っているので、色々な不具合が発生する可能性があります。

## 使用方法

大したアプリではないですが一応手順を説明します。

1. 動画ファイルを選択
2. 出力するGIFのフレームレートを設定
3. `Convert to GIF` をクリック
4. （GIFをダウンロードしたい場合）`Download GIF` をクリック

## 使ったもの

- [ffmpeg.wasm](https://github.com/ffmpegwasm/ffmpeg.wasm)
  - 動画変換のため
- [Vercel](https://vercel.com/)
  - Webアプリのホスティング先として
- [next.js](https://nextjs.org/)
  - [チーム個々人のテックブログをRSSで集約するサイトを作った（Next.js）](https://zenn.dev/catnose99/articles/cb72a73368a547756862) で `Vercel` を使ったときに手軽にデプロイできるのは良いなー、と思ったので。
  - あまり詳しくないので雰囲気で使っています。



# ハマりどころ

## npm 経由でインストールしたパッケージはブラウザで使えない

[npmjs.com](https://www.npmjs.com/search?q=%40ffmpeg) でも配布されていますが、こちらはおそらく `Node.js` 用のパッケージのようです。


（もしかしたら回避方法はあるのかな）

## SharedArrayBuffer が使えないブラウザでは変換できない

[Installation](https://github.com/ffmpegwasm/ffmpeg.wasm#installation) のところに書かれていたのですが、[SharedArrayBuffer](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer) が使えないブラウザでは実行できないようです。

> Only browsers with SharedArrayBuffer support can use ffmpeg.wasm, you can check HERE for the complete list.



## 大きなファイルを扱えない（未検証）

オンメモリでしか動かないようなので、容量の大きなファイルだと変換できないです。

![ffmpeg error](https://i.gyazo.com/c4ca6175c0f7642099b9e85b5b7e814f.png)

@[tweet](https://twitter.com/ko_noike/status/1326413474231095296)

今回は短い動画でGIFアニメーションを作っていたので、問題にならなかったようです。


