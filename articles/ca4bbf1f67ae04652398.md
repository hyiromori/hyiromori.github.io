---
title: "ffmpeg.wasm を使ってGIF動画を作れるWebアプリを作って遊んでみた"
emoji: "📹"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["FFmpeg", "WebAssembly", "WASM"]
published: false
---

## はじめに

コネヒト社で定期的に開催している[フロントエンドの勉強会(※)](https://www.wantedly.com/companies/connehito/post_articles/211397) で、FFmpeg が WebAssembly で使えるという情報を耳にしたので、遊びがてらブラウザだけで動画をGIFに変換するWebアプリを作ってみました。
（※コロナでリモートワークになってから、ランチではなくおやつタイムにやっています）

@[tweet](https://twitter.com/hyiromori/status/1328251958788976641)

ffmpeg.wasm の公式リポジトリと、解説記事へのリンクを貼っておきます。

https://github.com/ffmpegwasm/ffmpeg.wasm

https://gigazine.net/news/20201109-ffmpeg-wasm/



# 作ったWebアプリ

https://video-to-gif.vercel.app/

https://github.com/hyiromori/video-to-gif

Google Chrome だけ動作確認をしています。他のブラウザはおそらく使えません。
また大きな動画ファイルを変換した場合はエラーになります。
（これらの理由は「ハマりどころ」の章をご覧ください）


## 使用方法

大したアプリではないですが一応手順を説明します。

![How to use](https://i.gyazo.com/236042299cc18c6a6282efa82dea14b2.gif)

1. 動画ファイルを選択
2. 出力するGIFのフレームレートを設定
3. `Convert to GIF` をクリック
4. （GIFをダウンロードしたい場合）`Download GIF` をクリック


## 使ったもの

- [ffmpeg.wasm](https://github.com/ffmpegwasm/ffmpeg.wasm)
  - 動画変換のため
- [Vercel](https://vercel.com/)
  - Webアプリのホスティング先として
- [Next.js](https://nextjs.org/)
  - [チーム個々人のテックブログをRSSで集約するサイトを作った（Next.js）](https://zenn.dev/catnose99/articles/cb72a73368a547756862) で `Vercel` を使ったときに手軽にデプロイできるのは良いなー、と思ったので。
  - あまり詳しくないので雰囲気で使っています。



# ハマりどころ

## npm 経由でインストールしたパッケージはブラウザで使えない

[npmjs.com](https://www.npmjs.com/search?q=%40ffmpeg) でも配布されていますが、こちらはおそらく `Node.js` 用のパッケージのようです。

（もしかしたら回避方法はあるのかな）


## SharedArrayBuffer が使えないブラウザでは変換できない

[Installation](https://github.com/ffmpegwasm/ffmpeg.wasm#installation) のところに書かれていたのですが、[SharedArrayBuffer](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer) が使えないブラウザでは実行できないようです。

> Only browsers with SharedArrayBuffer support can use ffmpeg.wasm, you can check HERE for the complete list.


## 大きなファイルを扱えない（未検証）

オンメモリでしか動かないようなので、容量の大きなファイルだと変換できないです。

![ffmpeg error](https://i.gyazo.com/c4ca6175c0f7642099b9e85b5b7e814f.png)

@[tweet](https://twitter.com/ko_noike/status/1326413474231095296)

今回は短い動画でGIFアニメーションを作っていたので、問題にならなかったようです。



# まとめ

- 対応ブラウザが少ない
- ブラウザだけで動画変換ができるけど、オンメモリなので利用用途は現時点では限られそう
- WebAssembly 自体は何も触っていないので、知見はたまらなかった😅
