---
title: "JavaScriptで背景色から文字色を導出する"
emoji: "🚚"
type: "tech"
topics: []
published: true
---
## はじめに

このブログポストは GitHub のラベルのように、背景色をユーザーが自由に決めて、中に表示するテキストの色を計算で導出する、ということを実装する時に調べたことのメモです。

![capture](https://i.gyazo.com/bc937394a678180db13034e0fe38135d.png)



## 背景色の指定を決める

色の指定は様々ありますが、CSS でよく使うのはRGBの指定だと思います。

今回はRDBに背景色のデータを保存するので、16進数6桁のRGB値に固定すると扱いやすそうなので、背景色はこの指定方法に決めました。

```css
/* 背景色と文字色を16進数6桁のRGB値で指定する例 */
background-color: #000000;
color: #ffffff;
```



## 何を基準に文字色を判断するのか

何も分からなかったので、とりあえずRGBの値それぞれを合計してしきい値で判定すればできたりするのかなー、と思って試してみたんですが、どうもうまくいきません。

簡単に言ってしまえば「明るい色」の時は黒、「暗い色」の時は白と判定するだけなのですが、明るいか暗いかはRGBのままでは判定することができないようです。

というわけでいろいろ調べていると、YUVという色表現のうちのY(輝度)を使うと良さそう、というところまでたどり着きました。

[PHP で背景色に対して見えやすい文字色は白か黒かを判別する | Thought is free](https://thk.kanzae.net/net/itc/t7110/)



## RGBをY(輝度)に変換する

Wikipedia を見ると普通に計算式が載っていました。

![capture](https://i.gyazo.com/bae0b63cb7ec30c6bfb15b24130ed0f1.png)
[YUV - Wikipedia](https://ja.wikipedia.org/wiki/YUV)

JavaScript だとこんな感じで求められます。

```javascript
// 背景色(16進数6桁のRGB値)
const backgroudColor = 'abcdef';

// RGBをY(輝度)に変換
const brightness = 
    (parseInt(backgroudColor.substr(0, 2), 16) * 0.299) + // Red
    (parseInt(backgroudColor.substr(2, 2), 16) * 0.587) + // Green 
    (parseInt(backgroudColor.substr(4, 2), 16) * 0.114)   // Blue
```

## しきい値を決める

これに関しては実際に試してみて確認してみました。

- Preview: [背景色をベースに文字色を判定してみる](https://gistpreview.github.io/?4bd2acc20362e20546f5cf9009237239/scratch.html)
- Gist: [背景色をベースに文字色を判定してみる](https://gist.github.com/hyiromori/4bd2acc20362e20546f5cf9009237239)

![capture](https://i.gyazo.com/8817c6b6212fd752c8adbbb73ec88ba9.png)

(※ [gistpreview](https://github.com/gistpreview/gistpreview.github.io/)  を使うと Gist のプレビューが簡単にできて便利です)

いくつか試した結果 `140` で全体的に問題なさそうだったので、`140` を境に文字色を変更するようにしました。

```javascript
const brightness = Math.floor((parseInt(red, 16) * 0.299) + (parseInt(green, 16) * 0.587) + (parseInt(blue, 16) * 0.114))
const color = brightness >= 140 ? '000000' : 'FFFFFF'
```

あとはこの結果をスタイルに適用すればOKです！



## おわりに

YUVというのを今回調べて初めて知りましたが、こういう使い方のときに便利ですね。
似たような実装が必要になった際は参考にしてみてください。
また、こういう判定の仕方のほうが良いというのをご存じの方おられましたら、教えていただけると嬉しいです。



## 参考

- [YUV - Wikipedia](https://ja.wikipedia.org/wiki/YUV)
- [PHP で背景色に対して見えやすい文字色は白か黒かを判別する | Thought is free](https://thk.kanzae.net/net/itc/t7110/)
